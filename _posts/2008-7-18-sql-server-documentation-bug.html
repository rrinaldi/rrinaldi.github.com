<p><font face="Verdana" size="2">At work I needed to find a way to store an obscene amount of text in our database.&nbsp; Either I could use a varchar(7000+) datatype or I could shoot performance in the head and use the&nbsp;text datatype.&nbsp; The problem was that most of the time there wouldn't be more than, say, 500 characters.&nbsp; I didn't want to use text for that.&nbsp; Seemed way overkill.&nbsp; But I did need to store an unlimited amount of text.&nbsp; It was in the specs and as we all&nbsp;know, the specs are never wrong.&nbsp;</font></p> <p><font face="Verdana" size="2">I did some digging and came upon the "text in row" table option.&nbsp; After reading about it, I remembered hearing something about it when I was a regular on the SSWUG mailing lists.&nbsp; Looking even deeper, it seems perfect.&nbsp; Store the data in the row until you run out of room, then when need be (you run out of room in the row) bounce over to using a pointer and out of row storage.&nbsp; All automagically! Sweet!&nbsp; What is even cooler is that you don't need to worry about that WRITETEXT, UPDATETEXT, get a pointer to my data&nbsp;bullcrap.&nbsp; Just pretend it's a varchar field (that's what the first doc I read said).&nbsp; That makes my life easy.&nbsp; And I like easy.&nbsp;</font></p> <p><font face="Verdana" size="2">Then I notice&nbsp;that another doc&nbsp;completely contradicts the first doc I read.&nbsp; Well that isn't good.&nbsp; That makes my life hard, and I don't like hard. Here are the two contradictory statements:</font></p> <p><font face="Verdana" size="2">When you look up the stored procedure "sp_tableoption" (which you use to turn on "text in row") it states:</font></p> <p><font face="Verdana" size="2">"<font size="3"><font face="Times New Roman"><strong>text in row</strong> supports the <b>TEXTPTR</b>, <b>WRITETEXT</b>, <b>UPDATETEXT</b>, and <b>READTEXT</b> functions. Users can read parts of a BLOB with the SUBSTRING() function, but must keep in mind that in-row text pointers have different duration and number limits than other text pointers."</font></font></font></p> <p><font face="Verdana" size="2">When you look up "Text in Row Data" it states:</font></p> <p><font face="Verdana" size="2">"<font face="Times New Roman" size="3">After you have turned on the <b>text in row</b> option, you cannot use the READTEXT, UPDATETEXT or WRITETEXT statements, to read or modify parts of any <b>text</b>, <b>ntext</b>, or <b>image</b> value stored in the table. In SELECT statements you can read an entire <b>text</b>, <b>ntext</b>, or <b>image</b> string, or use the SUBSTRING function to read parts of the string. All INSERT or UPDATE statements referencing the table must specify complete strings and cannot modify only a part of a <b>text</b>, <b>ntext</b>, or <b>image</b> string."</font></font></p> <p><font face="Verdana" size="2">hmmmm.</font></p> <p><font face="Verdana" size="2">Which one is right?&nbsp; I guess that depends on your definition of the word "right".&nbsp; If by right you mean "correct" then the second one.&nbsp; If by "right" you mean "completely and horribly wrong" then the first one is the one you want.&nbsp;</font></p> <p><font face="Verdana" size="2">After some testing, it seems that you cannot use any of the text only statements on a text datatype after "text in row" has been set.&nbsp; Here is the script I used to try it out:</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">CREATE TABLE</font> [TextFieldTest1] (<br /> &nbsp;[TextField] [text] NOT NULL<br /> ) <font color="#0000ff">ON</font> [PRIMARY] <font color="#0000ff">TEXTIMAGE_ON</font> [PRIMARY]<br /> GO</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">CREATE TABLE</font> [TextFieldTest2] (<br /> &nbsp;[TextField] [text] NOT NULL<br /> ) <font color="#0000ff">ON</font> [PRIMARY] <font color="#0000ff">TEXTIMAGE_ON</font> [PRIMARY]<br /> GO</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">SELECT</font> TextField <font color="#0000ff">AS</font> Test1 <font color="#0000ff">FROM</font> TextFieldTest1</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">SELECT</font> TextField <font color="#0000ff">AS</font> Test2 <font color="#0000ff">FROM</font> TextFieldTest2</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">INSERT INTO</font> TextFieldTest1 <font color="#0000ff">VALUES</font> (<font color="#ff0000">'Insert Test 1'</font>)</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">INSERT INTO</font> TextFieldTest2 <font color="#0000ff">VALUES</font> (<font color="#ff0000">'Insert Test 1'</font>)</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">exec</font> <font color="#800000">sp_tableoption</font> <font color="#ff0000">'TextFieldTest2'</font>, <font color="#ff0000">'text in row'</font>, <font color="#ff0000">'ON'</font></font></p> <p><font face="Courier New" size="1"><font color="#0000ff">INSERT INTO</font> TextFieldTest1 <font color="#0000ff">VALUES</font> (<font color="#ff0000">'Insert Test 2'</font>)</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">INSERT INTO</font> TextFieldTest2 <font color="#0000ff">VALUES</font> (<font color="#ff0000">'Insert Test 2'</font>)</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">DECLARE</font> @ptrval1 <font color="#0000ff">binary</font>(16)<br /> <font color="#0000ff">SELECT</font> @ptrval1 = <font color="#ff00ff">TEXTPTR</font>(TextField) <font color="#0000ff">FROM</font> TextFieldTest1</font></p> <p><br /> <font face="Courier New" size="1"><font color="#0000ff">DECLARE</font> @ptrval2 <font color="#0000ff">binary</font>(16)<br /> <font color="#0000ff">SELECT</font> @ptrval2 = <font color="#ff00ff">TEXTPTR</font>(TextField) <font color="#0000ff">FROM</font> TextFieldTest2</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">WRITETEXT</font> TextFieldTest1.TextField @ptrval1 <font color="#ff0000">'WRITETEXT Test 1'</font></font></p> <p><font face="Courier New" size="1"><font color="#0000ff">WRITETEXT</font> TextFieldTest2.TextField @ptrval2 <font color="#ff0000">'WRITETEXT Test 1'</font></font></p> <p><font face="Courier New" size="1"><font color="#0000ff">SELECT</font> TextField <font color="#0000ff">AS</font> Test1 <font color="#0000ff">FROM</font> TextFieldTest1</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">SELECT</font> TextField <font color="#0000ff">AS</font> Test2 <font color="#0000ff">FROM</font> TextFieldTest2</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">DROP TABLE</font> TextFieldTest1</font></p> <p><font face="Courier New" size="1"><font color="#0000ff">DROP TABLE</font> TextFieldTest2</font></p> <p><font face="Verdana" size="2">You'll see that it will throw an error when you try to get a TEXTPTR from the TextFieldTest2 table.</font></p>