<p>A couple weeks ago we were making some changes to our web servers that required all the Application Pools to be running as a known domain user.&nbsp; While it&rsquo;s not hard to change it by hand, I figured it would be smarter for me to have 2 scripts, one to make the changes and the other to roll them back.&nbsp; So in the interests of the greater good, here they are:</p> <p>Change to a domain account -</p> <p><font face="Courier New">Dim locatorObj, ProviderObj, Pools, strQuery, appPool</font></p> <p><font face="Courier New">Set locatorObj = CreateObject("WbemScripting.SWbemLocator")<br />Set ProviderObj = locatorObj.ConnectServer(".", "root/MicrosoftIISv2")</font></p> <p><font face="Courier New">strQuery = "Select * from IIsApplicationPool"<br />For Each Item In ProviderObj.ExecQuery(strQuery)<br />&nbsp;&nbsp;&nbsp; WScript.Echo Replace(Item.Name, "W3SVC/AppPools/", "")<br />&nbsp;&nbsp;&nbsp; WScript.Echo "IIS://localhost/" &amp; Item.Name<br />&nbsp;&nbsp;&nbsp; Set appPool = GetObject("IIS://localhost/" &amp; Item.Name)<br />&nbsp;&nbsp;&nbsp; appPool.AppPoolIdentityType = 3<br />&nbsp;&nbsp;&nbsp; appPool.WAMUserName = "UserNameGoesHere"<br />&nbsp;&nbsp;&nbsp; appPool.WAMUserPass = "PasswordGoesHere"<br />&nbsp;&nbsp;&nbsp; appPool.SetInfo()<br />Next<br />WScript.Echo "Done!"</font></p> <p><font face="ar">Change to Network Service -</font></p> <p><font face="Courier New">Dim locatorObj, ProviderObj, Pools, strQuery, appPool</font></p> <p><font face="Courier New">Set locatorObj = CreateObject("WbemScripting.SWbemLocator")<br />Set ProviderObj = locatorObj.ConnectServer(".", "root/MicrosoftIISv2")</font></p> <p><font face="Courier New">strQuery = "Select * from IIsApplicationPool"<br />For Each Item In ProviderObj.ExecQuery(strQuery)<br />&nbsp;&nbsp;&nbsp; WScript.Echo Replace(Item.Name, "W3SVC/AppPools/", "")<br />&nbsp;&nbsp;&nbsp; WScript.Echo "IIS://localhost/" &amp; Item.Name<br />&nbsp;&nbsp;&nbsp; Set appPool = GetObject("IIS://localhost/" &amp; Item.Name)<br />&nbsp;&nbsp;&nbsp; appPool.AppPoolIdentityType =&nbsp;2<br />&nbsp;&nbsp;&nbsp; appPool.SetInfo()<br />Next</font><br /><font face="Courier New">WScript.Echo "Done!"</font></p> <p><font face="Courier New"></font>&nbsp;</p>