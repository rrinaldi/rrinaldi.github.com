<p><font face="Verdana" size="2">So, </font><a href="http://http://blogs.geekdojo.net/ryan/posts/387.aspx"><font face="Verdana" size="2">I've been</font></a><font face="Verdana" size="2"> </font><a href="http://http://blogs.geekdojo.net/ryan/posts/384.aspx"><font face="Verdana" size="2">trying</font></a><font face="Verdana" size="2"> to get my stupid ASP.NET app to create a couple folders out on the network.  That would sound easy enough, but apparently Microsoft decided that was a security risk.  So I need to use Impersonation.  Okay, well I tried that but apparently trying to impersonate a web user that logged in using NT Authentication does not give that user network access (KB Article describing this is </font><a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;207671"><font face="Verdana" size="2">here</font></a><font face="Verdana" size="2">).  </font></p> <p><font face="Verdana" size="2">&lt;RANT&gt;</font></p> <p><font face="Verdana" size="2">According to the KB article I linked to above, NT Authentication does not give you access to network resources.  BUT Basic Authentication does.</font></p> <p><font face="Verdana" size="2">“So Ryan, what is the difference between the two?”, you ask.</font></p> <p><font face="Verdana" size="2">Well, funny you should ask that.  You see NT Authentication passes a token from your machine to the web server informing the web server as to your identity.  The token contains no information that can actually be used to log you onto the machine in the event that somebody was to intercept it.  Now, Basic Authentication on the other hand passes your username and password in clear text to the web server.</font></p> <p><font face="Verdana" size="2">I'll let that sink in for a minute or two.</font></p> <p><font face="Verdana" size="2">[Ryan hums “</font><a href="http://www.columbia.edu/~sjt59/mr_nice.swf"><font face="Verdana" size="2">The Spanish Flea</font></a><font face="Verdana" size="2">“]</font></p> <p><font face="Verdana" size="2">Oh sorry.  I'm back now.</font></p> <p><font face="Verdana" size="2">If you didn't catch it, I said CLEAR TEXT.  Meaning anybody and their half retarded chihuahua can sniff your web traffic and log onto the machine as you.  And this abomination of security gives you greater access to the domain's resources?</font></p> <p><font face="Verdana" size="2">Huff.</font></p> <p><font face="Verdana" size="2">Either I am completely wrong when it comes to NT Authentication versus Basic Authentication or that needs some SERIOUS looking into.</font></p> <p><font face="Verdana" size="2">&lt;/RANT&gt;</font></p> <p><font face="Verdana" size="2">Okay, so I'm done ranting now but that still doesn't solve my problem about Impersonation.  </font><a href="http://blogs.geekdojo.net/ryan/posts/384.aspx"><font face="Verdana" size="2">So I tried </font></a><font face="Verdana" size="2">the standard .NET way of impersonating an user.  But as you can see, </font><a href="http://blogs.geekdojo.net/ryan/posts/387.aspx"><font face="Verdana" size="2">that didn't work</font></a><font face="Verdana" size="2">.  So I tried using some interop and logging on as an </font><a href="http://www.mostlylucid.co.uk/posts/662.aspx"><font face="Verdana" size="2">user with a known username and password</font></a><font face="Verdana" size="2">. [Thank you <a href="http://www.mostlylucid.co.uk/">Scott</a> for the post.  It gave me a glimmer of hope.]  That doesn't cut it either.  To make the LogonUser API call, the security context that the process is running under needs to have the “Act as part of the operating system.” flag set.  The ASPNET worker process does not.</font></p> <p><font face="Verdana" size="2">Huff.</font></p> <p><font face="Verdana" size="2">So it looks like I will be using the CreateProcessWithLogonW call, which allows me to spawn a new process under a new known logon, using that logons security credentials.  </font></p> <p><font face="Verdana" size="2">So, as soon as I get that taken care of I'll probably wrap it up with a nice little bow and throw it out here for you.</font></p> <p><font face="Verdana" size="2">Right now though, I'm going home.</font></p>